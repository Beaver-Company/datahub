{% extends "layout.html" %}
{% block content %}
<div id="content">
  <h3 class="inline-block">
    <a class="link" href=/browse/{{repo_base}}>{{repo_base}}</a> .
    <a class="link" href=/browse/{{repo_base}}/{{repo}}>{{repo}}</a> .
  </h3>
  
  <div class="pull-right">
    <a class="btn btn-primary" type="button" href="/console">Create Table with SQL</a>
    <a class="btn btn-primary" type="button" href="/browse/{{repo_base}}/{{repo}}#files">Upload Files</a>
    <a class="btn btn-primary" type="button" href="/data-refiner">Launch Data Refiner</a>  
  </div>
  <hr />
  <ul class="nav nav-tabs" role="tablist">
    <li class="active"><a href="#tables" role="tab" data-toggle="tab">Tables</a></li>
    <li><a href="#files" role="tab" data-toggle="tab">Files</a></li>
  </ul>

  <div class="tab-content">
    <div class="tab-pane active" id="tables">
      <h3>Tables</h3>
      {% if tables|length > 0 %}
        <div class="table-responsive">
          <table class="table table-striped table-bordered">
            <thead>
            <tr>
              <th>Table Name</th>
              <th></th>
            </tr>
            </thead>
            <tbody>
            {% for table in tables %}
            <tr>
              <td><a class="blue link" href="/browse/{{repo_base}}/{{repo}}/{{table}}">{{table}}</a></td>
              <td><a class="table-icon" href="/browse/{{repo_base}}/{{repo}}/{{table}}" title="View Table"></a> &nbsp; <a class="csv-icon" href="/export/{{repo_base}}/{{repo}}/{{table}}" title="Export to CSV"></a> &nbsp; <a class="delete-icon" href="/delete-table/{{repo_base}}/{{repo}}/{{table}}" title="Delete"></a></td>
            </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <span class="label label-warning">{{repo_base}} doesn't have any tables in {{repo}}.</span>
      {% endif %}
    </div>

    <div class="tab-pane" id="files">
      <br />
      <form class="form-inline" role="form" method="POST" action="/handle-file-upload" enctype='multipart/form-data'>
        {% csrf_token %}
        <input type="hidden" name="repo_base" value="{{repo_base}}" />
        <input type="hidden" name="repo" value="{{repo}}" />
        <input type="file" class="form-control" name="data_file" placeholder="Data File">
        <button class="btn btn-primary" type="submit">Upload File</button>
      </form>

      <h3>Files</h3>
      {% if files|length > 0 %}
        <div class="table-responsive">
          <table class="table table-striped table-bordered">
            <thead>
            <tr>
              <th>File Name</th>
              <th></th>
            </tr>
            </thead>
            <tbody>
            {% for file in files %}
            <tr>
              <td><a class="blue link" href="/download/{{repo_base}}/{{repo}}?file={{file}}">{{file}}</a></td>
              <td><a class="database-table-icon" href="/import/{{repo_base}}/{{repo}}?file={{file}}" title="Import to DataHub as Table"></a> &nbsp; <a class="download-icon" href="/download/{{repo_base}}/{{repo}}?file={{file}}" title="Download"></a> &nbsp; <a class="delete-icon" href="/delete/{{repo_base}}/{{repo}}?file={{file}}" title="Delete"></a></td>
            </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <span class="label label-warning">{{repo_base}} doesn't have any files in {{repo}}.</span>
      {% endif %}
    </div>
  </div>
</div>
<script>
$(function(){
  var hash = window.location.hash;
  hash && $('ul.nav a[href="' + hash + '"]').tab('show');

  $('.nav-tabs a').click(function (e) {
    $(this).tab('show');
    var scrollmem = $('body').scrollTop();
    window.location.hash = this.hash;
    $('html,body').scrollTop(scrollmem);
  });

  var tabs$ = $(".nav-tabs a");
  $( window ).on("hashchange", function() {
      var hash = window.location.hash, // get current hash
          menu_item$ = tabs$.filter("[href=" + hash + "]"); // get the menu element

      menu_item$.tab("show"); // call bootstrap to show the tab
  }).trigger("hashchange");
});
</script
{% endblock %}





