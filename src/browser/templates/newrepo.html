{% extends "layout.html" %}
{% block content %}
<div id="content">
  <h3 class="inline-block">
    <a class="link" href=/browse/{{repo_base}}>{{repo_base}}</a>
    <a class="link" href=/browse/{{repo_base}}>/</a>
  </h3>
  <hr />
  <h3>Create a new repository</h3>
  <p id="error"></p>
  <table>
    <tr>
      <td class="cell-left">Owner: </td>
      <td class="cell-right"><span class="label label-default">{{repo_base}}</span>
    </tr>
    <tr>
      <td class="cell-left">Name of the new repository: </td>
      <td class="cell-right"><input type="text" id="db-name" class="form-control" /></td>
    </tr>
    <tr>
      <td class="cell-left">
        <br />
        <button type="button" class="btn btn-primary" id="btn-create-repo">Create Repository</button>
      </td>
    </tr>
  </table>
  <br />
  <br />
</div>
  
<script type="text/javascript">


$(document).ready(function($) {
  var repo_base = '{{repo_base}}'
  var transport = new Thrift.Transport(window.location.protocol + '//' + window.location.host + '/service/json');
  var protocol = new Thrift.Protocol(transport);
  var client = new DataHubClient(protocol);
  var con = new Connection({'user':repo_base})
 
  var create_repo = function(){
    var db_name = $('#db-name').val();
    try {
      res = client.create_repo(con, db_name)
      if (res.status) {
        window.location.href='/browse/{{repo_base}}'
      }
    }catch(error){
      $('#error').html('<span class="error">' + error.message + '</span>');
    }
  }
  $("#btn-create-repo").click(create_repo);
});


</script>
{% endblock %}


